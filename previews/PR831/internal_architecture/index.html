<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Internal Architecture · HTTP.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">HTTP.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../public_interface/">Public Interface</a></li><li class="is-active"><a class="tocitem" href>Internal Architecture</a><ul class="internal"><li><a class="tocitem" href="#Request-Execution-Layers"><span>Request Execution Layers</span></a></li><li><a class="tocitem" href="#Parser"><span>Parser</span></a></li><li><a class="tocitem" href="#Messages"><span>Messages</span></a></li><li><a class="tocitem" href="#Streams"><span>Streams</span></a></li><li><a class="tocitem" href="#Connections"><span>Connections</span></a></li></ul></li><li><a class="tocitem" href="../internal_interface/">Internal Interfaces</a></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Internal Architecture</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Internal Architecture</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaWeb/HTTP.jl/blob/master/docs/src/internal_architecture.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Internal-Architecture"><a class="docs-heading-anchor" href="#Internal-Architecture">Internal Architecture</a><a id="Internal-Architecture-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-Architecture" title="Permalink"></a></h1><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.Layer</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.stack</code>. Check Documenter&#39;s build log for details.</p></div></div><h2 id="Request-Execution-Layers"><a class="docs-heading-anchor" href="#Request-Execution-Layers">Request Execution Layers</a><a id="Request-Execution-Layers-1"></a><a class="docs-heading-anchor-permalink" href="#Request-Execution-Layers" title="Permalink"></a></h2><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.RedirectLayer</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.BasicAuthLayer</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.CookieLayer</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.CanonicalizeLayer</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.MessageLayer</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.RetryLayer</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.ExceptionLayer</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.ConnectionPoolLayer</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.TimeoutLayer</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HTTP.StreamLayer</code>. Check Documenter&#39;s build log for details.</p></div></div><h2 id="Parser"><a class="docs-heading-anchor" href="#Parser">Parser</a><a id="Parser-1"></a><a class="docs-heading-anchor-permalink" href="#Parser" title="Permalink"></a></h2><p><em>Source: <code>Parsers.jl</code></em></p><article class="docstring"><header><a class="docstring-binding" id="HTTP.Parsers" href="#HTTP.Parsers"><code>HTTP.Parsers</code></a> — <span class="docstring-category">Module</span></header><section><div><p>The parser separates a raw HTTP Message into its component parts.</p><p>If the input data is invalid the Parser throws a <code>HTTP.ParseError</code>.</p><p>The <code>parse_*</code> functions processes a single element of a HTTP Message at a time and return a <code>SubString</code> containing the unused portion of the input.</p><p>The Parser does not interpret the Message Headers. It is beyond the scope of the Parser to deal with repeated header fields, multi-line values, cookies or case normalization.</p><p>The Parser has no knowledge of the high-level <code>Request</code> and <code>Response</code> structs defined in <code>Messages.jl</code>. However, the <code>Request</code> and <code>Response</code> structs must have field names compatible with those expected by the <code>parse_status_line!</code> and <code>parse_request_line!</code> functions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaWeb/HTTP.jl/blob/d01b25dd846e62b382af5c53b6d7108c1b396376/src/Parsers.jl#L1-L17">source</a></section></article><h2 id="Messages"><a class="docs-heading-anchor" href="#Messages">Messages</a><a id="Messages-1"></a><a class="docs-heading-anchor-permalink" href="#Messages" title="Permalink"></a></h2><p><em>Source: <code>Messages.jl</code></em></p><article class="docstring"><header><a class="docstring-binding" id="HTTP.Messages" href="#HTTP.Messages"><code>HTTP.Messages</code></a> — <span class="docstring-category">Module</span></header><section><div><p>The <code>Messages</code> module defines structs that represent <a href="../public_interface/#HTTP.Messages.Request"><code>HTTP.Request</code></a> and <a href="../public_interface/#HTTP.Messages.Response"><code>HTTP.Response</code></a> Messages.</p><p>The <code>Response</code> struct has a <code>request</code> field that points to the corresponding <code>Request</code>; and the <code>Request</code> struct has a <code>response</code> field. The <code>Request</code> struct also has a <code>parent</code> field that points to a <code>Response</code> in the case of HTTP Redirect.</p><p>The Messages module defines <code>IO</code> <code>read</code> and <code>write</code> methods for Messages but it does not deal with URIs, creating connections, or executing requests.</p><p>The <code>read</code> methods throw <code>EOFError</code> exceptions if input data is incomplete. and call parser functions that may throw <code>HTTP.ParsingError</code> exceptions. The <code>read</code> and <code>write</code> methods may also result in low level <code>IO</code> exceptions.</p><p><strong>Sending Messages</strong></p><p>Messages are formatted and written to an <code>IO</code> stream by <a href="../internal_interface/#Base.write-Tuple{IO, HTTP.Messages.Message}"><code>Base.write(::IO,::HTTP.Messages.Message)</code></a> and or <a href="../internal_interface/#HTTP.Messages.writeheaders"><code>HTTP.Messages.writeheaders</code></a>.</p><p><strong>Receiving Messages</strong></p><p>Messages are parsed from <code>IO</code> stream data by <a href="../internal_interface/#HTTP.Messages.readheaders"><code>HTTP.Messages.readheaders</code></a>. This function calls <a href="../internal_interface/#HTTP.Parsers.parse_header_field"><code>HTTP.Parsers.parse_header_field</code></a> and passes each header-field to <a href="../internal_interface/#HTTP.Messages.appendheader"><code>HTTP.Messages.appendheader</code></a>.</p><p><strong>Headers</strong></p><p>Headers are represented by <code>Vector{Pair{String,String}}</code>. As compared to <code>Dict{String,String}</code> this allows <a href="https://tools.ietf.org/html/rfc7230#section-3.2.2">repeated header fields and preservation of order</a>.</p><p>Header values can be accessed by name using <a href="../internal_interface/#HTTP.Messages.header"><code>HTTP.Messages.header</code></a> and <a href="../internal_interface/#HTTP.Messages.setheader"><code>HTTP.Messages.setheader</code></a> (case-insensitive).</p><p>The <a href="../internal_interface/#HTTP.Messages.appendheader"><code>HTTP.Messages.appendheader</code></a> function handles combining multi-line values, repeated header fields and special handling of multiple <code>Set-Cookie</code> headers.</p><p><strong>Bodies</strong></p><p>The <code>HTTP.Message</code> structs represent the Message Body as <code>Vector{UInt8}</code>.</p><p>Streaming of request and response bodies is handled by the <a href="@ref"><code>HTTP.StreamLayer</code></a> and the <a href="#HTTP.Streams.Stream"><code>HTTP.Stream</code></a> <code>&lt;: IO</code> stream.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaWeb/HTTP.jl/blob/d01b25dd846e62b382af5c53b6d7108c1b396376/src/Messages.jl#L1-L54">source</a></section></article><h2 id="Streams"><a class="docs-heading-anchor" href="#Streams">Streams</a><a id="Streams-1"></a><a class="docs-heading-anchor-permalink" href="#Streams" title="Permalink"></a></h2><p><em>Source: <code>Streams.jl</code></em></p><article class="docstring"><header><a class="docstring-binding" id="HTTP.Streams.Stream" href="#HTTP.Streams.Stream"><code>HTTP.Streams.Stream</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Stream(::Request, ::IO)</code></pre><p>Creates a <code>HTTP.Stream</code> that wraps an existing <code>IO</code> stream.</p><ul><li><p><code>startwrite(::Stream)</code> sends the <code>Request</code> headers to the <code>IO</code> stream.</p></li><li><p><code>write(::Stream, body)</code> sends the <code>body</code> (or a chunk of the body).</p></li><li><p><code>closewrite(::Stream)</code> sends the final <code>0</code> chunk (if needed) and calls <code>closewrite</code> on the <code>IO</code> stream.</p></li><li><p><code>startread(::Stream)</code> calls <code>startread</code> on the <code>IO</code> stream then  reads and parses the <code>Response</code> headers.</p></li><li><p><code>eof(::Stream)</code> and <code>readavailable(::Stream)</code> parse the body from the <code>IO</code>  stream.</p></li><li><p><code>closeread(::Stream)</code> reads the trailers and calls <code>closeread</code> on the <code>IO</code>  stream.  When the <code>IO</code> stream is a <a href="../internal_interface/#HTTP.ConnectionPool.Connection"><code>HTTP.ConnectionPool.Connection</code></a>,  calling <code>closeread</code> releases the connection back to the connection pool  for reuse. If a complete response has not been received, <code>closeread</code> throws  <code>EOFError</code>.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaWeb/HTTP.jl/blob/d01b25dd846e62b382af5c53b6d7108c1b396376/src/Streams.jl#L28-L47">source</a></section></article><h2 id="Connections"><a class="docs-heading-anchor" href="#Connections">Connections</a><a id="Connections-1"></a><a class="docs-heading-anchor-permalink" href="#Connections" title="Permalink"></a></h2><p><em>Source: <code>ConnectionPool.jl</code></em></p><article class="docstring"><header><a class="docstring-binding" id="HTTP.ConnectionPool" href="#HTTP.ConnectionPool"><code>HTTP.ConnectionPool</code></a> — <span class="docstring-category">Module</span></header><section><div><p>This module provides the <a href="../internal_interface/#HTTP.ConnectionPool.newconnection"><code>newconnection</code></a> function with support for:</p><ul><li>Opening TCP and SSL connections.</li><li>Reusing connections for multiple Request/Response Messages</li></ul><p>This module defines a <a href="../internal_interface/#HTTP.ConnectionPool.Connection"><code>Connection</code></a> struct to manage the lifetime of a connection and its reuse. Methods are provided for <code>eof</code>, <code>readavailable</code>, <code>unsafe_write</code> and <code>close</code>. This allows the <code>Connection</code> object to act as a proxy for the <code>TCPSocket</code> or <code>SSLContext</code> that it wraps.</p><p>The <a href="../internal_interface/#HTTP.ConnectionPool.POOL"><code>POOL</code></a> is used to manage connection pooling. Connections are identified by their host, port, whether they require ssl verification, and whether they are a client or server connection. If a subsequent request matches these properties of a previous connection and limits are respected (reuse limit, idle timeout), and it wasn&#39;t otherwise remotely closed, a connection will be reused.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaWeb/HTTP.jl/blob/d01b25dd846e62b382af5c53b6d7108c1b396376/src/ConnectionPool.jl#L1-L19">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../public_interface/">« Public Interface</a><a class="docs-footer-nextpage" href="../internal_interface/">Internal Interfaces »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.18 on <span class="colophon-date" title="Wednesday 25 May 2022 22:20">Wednesday 25 May 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
